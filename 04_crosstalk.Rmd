---
title: Fiji earthquakes
output: html_document
---

```{r, echo=FALSE, include=FALSE}

#  devtools::load_all('C:/Users/matt.landis/OneDrive - Resource Systems Group, Inc/Git/tmrtools')


library(crosstalk)
library(leaflet)
library(DT)

# # Define scales for map
# pal = colorNumeric(get_rsg_palette('hot'),
#   domain=c(min(quakes$mag), max(quakes$mag)))

rad_scale = function(mag){
  sizemin = 5
  sizemax = 15
  sizerange = sizemax - sizemin
  datarange = max(quakes$mag) - min(quakes$mag)
  scale = sizerange / datarange
  radius = (mag - min(quakes$mag)) * scale
  return(radius)
}

# Get built-in dataset and sample it
data(quakes)

# Wrap data frame in SharedData ------------------------------------------------

sd = SharedData$new(quakes)

# Create a filter input
filter_slider(
  id="mag", 
  label="Magnitude", 
  sharedData=sd,
  column=~mag,
  step=0.1,
  width=250)


# Use SharedData like a dataframe with Crosstalk-enabled widgets--------------

# bscols(

leaflet(quakes) %>%
  addTiles() %>%
  addMarkers()
  
  # addCircleMarkers(lng=~long, lat=~lat, stroke=FALSE, fillOpacity=0.8, color=~pal(mag), radius=~rad_scale(mag)) %>%
  # addLegend(pal=pal, values=~mag, opacity=0.8),

  datatable(
    data=sd,
    extensions="Scroller",
    style="bootstrap",
    class="compact",
    width="100%",
    options=list(
      deferRender=TRUE,
      scrollY=300,
      scroller=TRUE)
    )
# )
```